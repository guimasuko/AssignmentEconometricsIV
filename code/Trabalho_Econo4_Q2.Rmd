---
title: "Trabalho - Econometria IV"
author: "Guilherme Luz, Guilherme Masuko, Caio Garzeri"
date: "`r format(Sys.time(), '%B %Y')`"
output: 
  pdf_document: 
    keep_tex: true
geometry: margin=1in
#bibliography: references.bib 
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(cache = T, echo = T, tidy = TRUE, tidy.opts = list(width.cutoff = 60), warning = F, message = F)
```

```{r library, include=FALSE}
library(tidyverse)
library(ggplot2)
library(stargazer)
library(kableExtra)
library(gridExtra)
```

```{r}
library(BVAR)
library(lubridate)
```


```{r plot_setup, include=FALSE}
# Configurações 
theme_set(theme_linedraw())
theme_update(title = element_text(family = 'serif'),
             legend.text = element_text(family = 'serif')) 
```

# Questão 2

```{r}
raw_data = read_csv('data/2021-12.csv')
data0 = raw_data[-1,] %>% select_if(~ !any(is.na(.)))
transformation = raw_data[1,]
```

Transformation codes

1. no transformation
2. $\Delta x_t$
3. $\Delta^2 x_t$ 
4. $\log(x_t)$
5. $\Delta \log(x_t)$
6. $\Delta^2 \log(x_t)$
7. $\Delta (x_t/x_{t-1} -1)$

```{r}
# data transformations based on the FRED transformation codes
data = data0 %>% select(-sasdate) %>% fred_transform(type = 'fred_md') %>%
  bind_cols(tibble(date = data0$sasdate[3:length(data0$sasdate)])) 

# for the CPI, we transform into a inflation series
data = mutate(data, CPIAUCSL = 100*(diff(data0$CPIAUCSL, differences = 1)/data0$CPIAUCSL[-1])[-1])
```

\textcolor{blue}{Detalhe: estou usando a definição de inflação dada no enunciado $\pi_t = \frac{\Delta P_t}{P_t}$, que difere da definição usual $\pi_t = \frac{\Delta P_t}{P_{t-1}}$}

```{r}
# plot inflation
inflation = data$CPIAUCSL

data %>% 
  select(date, CPIAUCSL) %>%
  mutate(date = as.Date(date, format = '%m/%d/%Y')) %>%
  #filter(date>as.Date('2000-01-01')) %>%
  ggplot(aes(x = date, y = CPIAUCSL))+
  geom_line()
```


## Item A

### AR

```{r}
# Partial autocorrelation
pacf(inflation, lag.max = 24)
```


```{r}
p.max = 24
bic.table = c()

for(p in 0:p.max){
  AR = arima(inflation, order = c(p,0,0))
  bic.line = tibble("p"=p, "BIC" = BIC(AR))
  bic.table = rbind(bic.table, bic.line)
}

plot(bic.table$p, bic.table$BIC)
```
```{r}
p.opt = bic.table$p[which.min(bic.table$BIC)]
```

The p chosen with the BIC information criterion was `r p.opt`

### AR + PC

### Ridge Regression

### LASSO Regression








